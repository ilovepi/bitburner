/** @param {NS} ns **/
export async function main(ns) {
	if(ns.args.length != 2){
		ns.tprint("error: incorrect number of arguments command <server> <target>");
		return;
	}
	const driver_script = "/scripts/attack_analysis.js";
	const hack_script = "/scripts/basics/hack.js";
	const grow_script = "/scripts/basics/grow.js";
	const weaken_script = "/scripts/basics/weaken.js";
	var worklist = [];
	var visited = [];
	let host = ns.getHostname()
	worklist.push(host)
	let target_host = ns.args[0];
	let target = ns.args[1];

	while (worklist.length != 0) {
		var server = worklist.pop(1);
		//ns.tprintf("Visiting %s", server);
		visited.push(server);
		let adjacent = ns.scan(server);
		for (const a of adjacent) {
			if (visited.includes(a)) {
				continue;
			} else {
				worklist.push(a);
			}
		}
		if(target_host != server) continue;
		if (!ns.hasRootAccess(server))
			continue;


		await ns.scp(driver_script, server);
		await ns.scp(hack_script, server);
		await ns.scp(grow_script, server);
		await ns.scp(weaken_script, server);

		ns.killall(server);
		ns.exec(driver_script, server, 1, target);
	}
}